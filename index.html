<!DOCTYPE html>
<html>
    <head>
        <title>Monthly Chattanooga Stats</title>
        <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
        <script>
            window.app = {
                data: {
                    rows: []
                },
                state: {

                }
            }
        </script>
    </head>
    <body>
        <h1>
        <form class="max-w-sm mx-auto">
            <h3 class="text-3xl font-extrabold dark:text-white mb-3">Monthly Stats about Chattanooga</h3>
            
            <div class="grid grid-cols-2 gap-6">
                <div class="relative z-0 w-full mb-5 group">
                    <input type="number" name="year" id="year" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required/>
                    <label for="year" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Year</label>
                </div>
                <div class="relative z-0 w-full mb-5 group">
                    <input type="number" name="month" id="month" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
                    <label for="month" class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Month</label>
                </div>
            </div>

            <div id="results">
                <div class="relative overflow-x-auto">
                    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                    </table>
                </div>
            </div>
        </form>
        
        <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
        <script src="https://unpkg.com/papaparse@5.5.3/papaparse.min.js"></script>
        <script src="https://unpkg.com/easy-file-saver@0.2.0/easy-file-saver.js"></script>        
        <script>
            app.state.year = document.getElementById("year").value = new Date().getFullYear();
            app.state.month = document.getElementById("month").value = new Date().getMonth();

            document.getElementById("year").addEventListener("input", function () {
                app.state.year = Number(document.getElementById("year").value);
                render();
            });
            document.getElementById("month").addEventListener("input", function () {
                app.state.month = Number(document.getElementById("month").value);
                render();
            });            
            (async function () {
                const response = await fetch("./stats.csv");
                const text = await response.text();
                const parsed = Papa.parse(text, { header: true });
                const rows = parsed.data;
                console.log("rows:", rows);
                rows.forEach(row => {
                    row.year = Number(row.year);
                    row.month = Number(row.month);
                })
                app.data.rows = rows;
                render();
            })();

            function render() {
                const row = app.data.rows.find(row => row.year === app.state.year && row.month === app.state.month);
                
                const table = document.querySelector("#results table");
                table.innerHTML = Object.entries(row).map(([k, v]) => `<tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200"><td class="px-3 py-2">${k}</td><td class="px-3 py-2">${v}</td></tr>`).join("");
            }
        </script>
    </body>
</html>